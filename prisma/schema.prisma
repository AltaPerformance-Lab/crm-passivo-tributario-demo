// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum LeadStatus {
  A_VERIFICAR
  VERIFICADO
  CONTATADO
  AGUARDANDO_RESPOSTA
  EM_NEGOCIACAO
  NAO_TEM_INTERESSE
  CONVERTIDO
  DESCARTADO
}

model Empresa {
  id                      Int       @id @default(autoincrement())
  cnpj                    String    @unique
  razaoSocial             String
  nomeFantasia            String?
  situacaoCadastral       String
  dataSituacaoCadastral   String?
  logradouro              String?
  numero                  String?
  bairro                  String?
  cep                     String?
  municipio               String?
  uf                      String?
  capitalSocial           Float?
  telefone                String?
  porte                   String?
  naturezaJuridica        String?
  cnaeFiscalDescricao     String?
  dataInicioAtividade     String?
  regimeTributario        String?
  cnaesSecundarios        Json?
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  socios                  Socio[]
  contatos                Contato[]
  lead                    Lead?
}

model Socio {
  id                     Int     @id @default(autoincrement())
  nomeSocio              String
  qualificacaoSocio      String
  dataEntradaSociedade   String?
  documento              String?
  empresa                Empresa @relation(fields: [empresaId], references: [id])
  empresaId              Int
}

model Contato {
  id         Int      @id @default(autoincrement())
  nome       String
  cargo      String?
  telefone   String?
  email      String?
  observacao String?
  createdAt  DateTime @default(now())
  empresa    Empresa  @relation(fields: [empresaId], references: [id])
  empresaId  Int
}

model Lead {
  id               Int        @id @default(autoincrement())
  cnpj             String     @unique
  nomeDevedor      String
  nomeFantasia     String?
  valorTotalDivida Float
  status           LeadStatus @default(A_VERIFICAR)
  municipio        String?
  uf               String?
  createdAt        DateTime   @default(now())
  updatedAt        DateTime   @updatedAt
  empresaId        Int?       @unique
  empresa          Empresa?   @relation(fields: [empresaId], references: [id])
  negocio          Negocio?

  atividades       Atividade[]

  lembretes   Lembrete[]

  @@index([nomeDevedor])
  @@index([municipio])
}

model Negocio {
  id                Int        @id @default(autoincrement())
  valorFechado      Float
  valorEscritorio   Float      @default(0)
  valorOutraParte   Float
  valorRecebido     Float
  dataFechamento    DateTime   @default(now())
  propostaUrl       String?
  lead              Lead       @relation(fields: [leadId], references: [id])
  leadId            Int        @unique
  propostas         Proposta[]
}

model Proposta {
  id        Int      @id @default(autoincrement())

  // --- Campos para a proposta GERADA (agora opcionais) ---
  objeto    String?
  escopo    String?  @db.Text
  valores   String?  @db.Text
  validade  DateTime?

  // --- Campos para o ARQUIVO (seja gerado ou de upload) ---
  nomeArquivo    String?  // O nome original do arquivo
  caminhoArquivo String   // O caminho/URL para o arquivo salvo
  
  createdAt DateTime @default(now())
  negocio   Negocio  @relation(fields: [negocioId], references: [id])
  negocioId Int
}

model Configuracao {
  id          Int     @id @default(1)
  nomeEmpresa String?
  cnpj        String?
  endereco    String?
  email       String?
  telefone    String?
  logoUrl     String?
}

model Atividade {
  id        Int      @id @default(autoincrement())
  conteudo  String   @db.Text
  criadoEm  DateTime @default(now())

  lead      Lead     @relation(fields: [leadId], references: [id])
  leadId    Int
}

model Lembrete {
  id        Int      @id @default(autoincrement())
  data      DateTime
  descricao String
  concluido Boolean  @default(false)
  criadoEm  DateTime @default(now())

  lead      Lead     @relation(fields: [leadId], references: [id])
  leadId    Int
}