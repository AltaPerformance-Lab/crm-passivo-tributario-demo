generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  USER
}

model User {
  id           String         @id @default(cuid())
  name         String?
  email        String?        @unique
  password     String?
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  role         Role           @default(USER)
  leads        Lead[]
  negocios     Negocio[]
  configuracao Configuracao?
}

enum LeadStatus {
  A_VERIFICAR
  VERIFICADO
  CONTATADO
  AGUARDANDO_RESPOSTA
  EM_NEGOCIACAO
  NAO_TEM_INTERESSE
  CONVERTIDO
  DESCARTADO
}

model Empresa {
  id                      Int       @id @default(autoincrement())
  cnpj                    String    @unique
  razaoSocial             String
  nomeFantasia            String?
  situacaoCadastral       String
  dataSituacaoCadastral   String?
  logradouro              String?
  numero                  String?
  bairro                  String?
  cep                     String?
  municipio               String?
  uf                      String?
  capitalSocial           Float?
  telefone                String?
  porte                   String?
  naturezaJuridica        String?
  cnaeFiscalDescricao     String?
  dataInicioAtividade     String?
  regimeTributario        String?
  cnaesSecundarios        Json?
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  socios                  Socio[]
  contatos                Contato[]
  lead                    Lead?
}

model Socio {
  id                     Int      @id @default(autoincrement())
  nomeSocio              String
  // ... outros campos ...
  empresa                Empresa  @relation(fields: [empresaId], references: [id], onDelete: Cascade)
  empresaId              Int
}

model Contato {
  id         Int      @id @default(autoincrement())
  nome       String
  // ... outros campos ...
  empresa    Empresa  @relation(fields: [empresaId], references: [id], onDelete: Cascade)
  empresaId  Int
}

model Lead {
  id               String     @id @default(cuid()) // PADRONIZADO para String
  cnpj             String
  nomeDevedor      String
  nomeFantasia     String?
  valorTotalDivida Float
  status           LeadStatus @default(A_VERIFICAR)
  municipio        String?
  uf               String?
  createdAt        DateTime   @default(now())
  updatedAt        DateTime   @updatedAt
  empresaId        Int?       @unique
  empresa          Empresa?   @relation(fields: [empresaId], references: [id])
  negocio          Negocio?
  atividades       Atividade[]
  lembretes        Lembrete[]
  userId           String
  user             User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@unique([cnpj, userId])
  @@index([userId])      // ADICIONADO: Para performance
  @@index([nomeDevedor])
  @@index([municipio])
}

model Negocio {
  id                String     @id @default(cuid()) // PADRONIZADO para String
  valorFechado      Float
  valorEscritorio   Float      @default(0)
  valorOutraParte   Float
  valorRecebido     Float
  dataFechamento    DateTime   @default(now())
  lead              Lead       @relation(fields: [leadId], references: [id])
  leadId            String     @unique // PADRONIZADO para String
  propostas         Proposta[]
  userId            String
  user              User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])      // ADICIONADO: Para performance
}

model Proposta {
  id             String    @id @default(cuid()) // PADRONIZADO para String
  objeto         String?
  escopo         String?   @db.Text
  valores        String?   @db.Text
  validade       DateTime?
  nomeArquivo    String?
  caminhoArquivo String
  createdAt      DateTime  @default(now())
  negocio        Negocio   @relation(fields: [negocioId], references: [id], onDelete: Cascade)
  negocioId      String    // PADRONIZADO para String
}

model Configuracao {
  id          String  @id @default(cuid()) // PADRONIZADO para String
  nomeEmpresa String?
  cnpj        String?
  endereco    String?
  email       String?
  telefone    String?
  logoUrl     String?
  userId      String  @unique
  user        User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId]) // ADICIONADO: Para performance
}

model Atividade {
  id        String   @id @default(cuid()) // PADRONIZADO para String
  conteudo  String   @db.Text
  criadoEm  DateTime @default(now())
  lead      Lead     @relation(fields: [leadId], references: [id], onDelete: Cascade)
  leadId    String   // PADRONIZADO para String
}

model Lembrete {
  id        String   @id @default(cuid()) // PADRONIZADO para String
  data      DateTime
  descricao String
  concluido Boolean  @default(false)
  criadoEm  DateTime @default(now())
  lead      Lead     @relation(fields: [leadId], references: [id], onDelete: Cascade)
  leadId    String   // PADRONIZADO para String
}